<!DOCTYPE html>
el.contentEditable = editing;
if(editing){ el.focus(); }
});
if(!editing){ saveEdits(); }
}


function saveEdits(){
const data = {};
document.querySelectorAll('.editable').forEach(el => {
data[el.dataset.key] = el.innerHTML.trim();
});
localStorage.setItem('gauprem_page_copy_v1', JSON.stringify(data));
}


function loadEdits(){
try{
const data = JSON.parse(localStorage.getItem('gauprem_page_copy_v1')) || {};
document.querySelectorAll('.editable').forEach(el => {
if(data[el.dataset.key]) el.innerHTML = data[el.dataset.key];
});
}catch(e){}
}


function downloadHTML(){
const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url; a.download = 'gauprem.html'; a.click();
URL.revokeObjectURL(url);
}


loadEdits();


editBtn.addEventListener('click', () => setEditing(!editing));
downloadBtn.addEventListener('click', downloadHTML);
settingsBtn.addEventListener('click', () => {
cfgGfm.value = cfg.gofundmeUrl; cfgImg.value = cfg.heroImg; dialog.showModal();
});
dialog.addEventListener('close', () => {
if(dialog.returnValue === 'default'){
cfg.gofundmeUrl = cfgGfm.value || DEFAULTS.gofundmeUrl;
cfg.heroImg = cfgImg.value || DEFAULTS.heroImg;
saveConfig(cfg); applyConfig();
}
});


// Optional: auto-resize Google Form height if it grows
window.addEventListener('message', (e) => {
if(!e.data || typeof e.data !== 'string') return;
if(e.data.indexOf('set-height') > -1){
const n = parseInt(e.data.split(':').pop(), 10);
const f = document.getElementById('gform');
if(f && !Number.isNaN(n) && n > 400 && n < 2000){ f.style.height = n + 'px'; }
}
});
</script>
</body>
</html>
